<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" 
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{layout/admin/admindefault}">

<th:block layout:fragment="adminMainContents">

<div id="content" class="row">
                <div class="col-xs-12">
                    <div class="page-header js-affix">
    <h3>가입승인/등급변경</h3>
    <input type="button" value="가입승인/등급변경 처리" class="btn btn-red btn-register"/>
</div>

<form id="formSearch" method="get" class="content-form js-search-form js-form-enter-submit">
    <input type="hidden" name="indicate" value="search"/>
    <input type="hidden" name="pageNum" value="10"/>
    <div class="table-title gd-help-manual">
        대상회원 선택
    </div>
    <div class="search-detail-box form-inline">
    <input type="hidden" name="detailSearch" value=""/>
    <table class="table table-cols">
        <colgroup>
            <col class="width-md">
            <col class="width-3xl">
            <col class="width-md">
            <col class="width-3xl">
        </colgroup>
        <tbody>
                    <tr>
                <th>상점</th>
                <td colspan="3">
                    <label class="radio-inline">
                        <input type="radio" name="mallSno"
                               value="" checked="checked"/>
                        전체
                    </label>
                                            <label class="radio-inline">
                            <input type="radio" name="mallSno"
                                   value="1" />
                            <span class="flag flag-16 flag-kr"></span>기준몰                        </label>
                                            <label class="radio-inline">
                            <input type="radio" name="mallSno"
                                   value="2" />
                            <span class="flag flag-16 flag-us"></span>영문몰                        </label>
                                            <label class="radio-inline">
                            <input type="radio" name="mallSno"
                                   value="3" />
                            <span class="flag flag-16 flag-cn"></span>중문몰                        </label>
                                            <label class="radio-inline">
                            <input type="radio" name="mallSno"
                                   value="4" />
                            <span class="flag flag-16 flag-jp"></span>일문몰                        </label>
                                    </td>
            </tr>
                <tr>
            <th>검색어</th>
            <td colspan="3">
                <select class=" form-control" id="key" name="key" ><option value="memId"  >아이디</option><option value="memNm"  >이름</option><option value="nickNm"  >닉네임</option><option value="email"  >이메일</option><option value="cellPhone"  >휴대폰번호</option><option value="phone"  >전화번호</option><option value="__disable5"  disabled>==========</option><option value="company"  >회사명</option><option value="busiNo"  >사업자등록번호</option><option value="ceo"  >대표자명</option><option value="__disable8"  disabled>==========</option><option value="recommId"  >추천인아이디</option><option value="fax"  >팩스번호</option></select>                <input type="text" name="keyword" value=""
                       class="form-control"/>
            </td>
        </tr>
        <tr>
            <th>회원등급</th>
            <td>
                <select class="form-control " id="groupSno" name="groupSno" ><option value="">등급</option><option value="1"  >일반회원</option><option value="2"  >우수회원</option></select>            </td>
            <th>회원구분</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="memberFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="memberFl"
                           value="personal" />
                    개인회원
                </label>
                <label class="radio-inline">
                    <input type="radio" name="memberFl"
                           value="business" />
                    사업자회원
                </label>
            </td>
        </tr>
        <tr>
            <th>가입승인</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="appFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="appFl"
                           value="y" />
                    승인
                </label>
                <label class="radio-inline">
                    <input type="radio" name="appFl"
                           value="n" />
                    미승인
                </label>
            </td>
            <th>회원가입일</th>
            <td>
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="entryDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
                ~
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="entryDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
            </td>
        </tr>
        </tbody>
        <tbody class="js-search-detail">
        <tr>
            <th>방문횟수</th>
            <td>
                <input type="text" class="form-control" name="loginCnt[]" size="7"
                       value=""/>
                회 ~
                <input type="text" class="form-control" name="loginCnt[]" size="7"
                       value=""/>
                회
            </td>
            <th>최종로그인일</th>
            <td>
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="lastLoginDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
                ~
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="lastLoginDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
            </td>
        </tr>
        <tr>
            <th>마일리지</th>
            <td>
                <input type="text" class="form-control js-number" name="mileage[]" size="7"
                       value=""/>
                원 ~
                <input type="text" class="form-control js-number" name="mileage[]" size="7"
                       value=""/>
                원
            </td>
            <th>예치금</th>
            <td>
                <input type="text" class="form-control js-number" name="deposit[]" size="7"
                       value=""/>
                원 ~
                <input type="text" class="form-control js-number" name="deposit[]" size="7"
                       value=""/>
                원
            </td>
        </tr>
        <tr>
            <th>상품주문건수</th>
            <td>
                <input type="text" class="form-control js-number" name="saleCnt[]" size="7"
                       value=""/>
                건 ~
                <input type="text" class="form-control js-number" name="saleCnt[]" size="7"
                       value=""/>
                건
            </td>
            <th>주문금액</th>
            <td>
                <input type="text" class="form-control js-number" name="saleAmt[]" size="7"
                       value=""/>
                원 ~
                <input type="text" class="form-control js-number" name="saleAmt[]" size="7"
                       value=""/>
                원
            </td>
        </tr>
        <tr>
            <th>SMS수신동의</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="smsFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="smsFl"
                           value="y" />
                    수신
                </label>
                <label class="radio-inline">
                    <input type="radio" name="smsFl"
                           value="n" />
                    수신거부
                </label>
            </td>
            <th>메일수신동의</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="maillingFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="maillingFl"
                           value="y" />
                    수신
                </label>
                <label class="radio-inline">
                    <input type="radio" name="maillingFl"
                           value="n" />
                    수신거부
                </label>
            </td>
        </tr>
        <tr>
            <th>가입경로</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="entryPath"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="entryPath"
                           value="pc" />
                    PC
                </label>
                <label class="radio-inline">
                    <input type="radio" name="entryPath"
                           value="mobile" />
                    모바일
                </label>
            </td>
            <th>장기 미로그인</th>
            <td>
                <input type="text" class="form-control js-number" name="novisit" size="7"
                       value=""/>
                일 이상 로그인하지 않은 회원
            </td>
        </tr>
        <tr>
            <th>성별</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="sexFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="sexFl"
                           value="m" />
                    남자
                </label>
                <label class="radio-inline">
                    <input type="radio" name="sexFl"
                           value="w" />
                    여자
                </label>
            </td>
            <th>생일</th>
            <td>
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="birthCheckFl" name="birthFl" value="">
                        특정일 검색
                    </label>
                </div>
                <select class="form-control " id="calendarFl" name="calendarFl" ><option value="">전체</option><option value="s"  >양력</option><option value="l"  >음력</option></select>                <div class="input-group js-datepicker-month">
                    <input type="text" id="birthDt1" class="form-control js-number" placeholder="" name="birthDt[]" value="" maxlength="10"/>
                </div>
                <div class="input-group js-datepicker firstdate">
                    <input type="hidden" id="yBirthDt1" class="form-control" placeholder="" value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
                <div class="input-group seconddate"> ~ </div>
                <div class="input-group js-datepicker-month seconddate">
                    <input type="text" id="birthDt2" class="form-control js-number seconddate" placeholder="" name="birthDt[]" value="" maxlength="10"/>
                </div>
                <div class="input-group js-datepicker seconddate">
                    <input type="hidden" id="yBirthDt2" class="form-control seconddate" placeholder="" value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
            </td>
        </tr>
        <tr>
            <th>결혼여부</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="marriFl"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="marriFl"
                           value="n" />
                    미혼
                </label>
                <label class="radio-inline">
                    <input type="radio" name="marriFl"
                           value="y" />
                    기혼
                </label>
            </td>
            <th>결혼기념일</th>
            <td>
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="marriDate[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
                ~
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="marriDate[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
            </td>
        </tr>
        <tr>
            <th>개인정보유효기간</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="expirationFl"
                           value=""checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="expirationFl"
                           value="1" />
                    1년
                </label>
                <label class="radio-inline">
                    <input type="radio" name="expirationFl"
                           value="3" />
                    3년
                </label>
                <label class="radio-inline">
                    <input type="radio" name="expirationFl"
                           value="5" />
                    5년
                </label>
                <label class="radio-inline">
                    <input type="radio" name="expirationFl"  id="expirationNone"
                           value="999" />
                    탈퇴 시
                </label>
            </td>
            <th>휴면 전환 예정 회원</th>
            <td>
                <label class="checkbox-inline mgl10">
                    <input type="checkbox" id="dormantMemberExpected" name="dormantMemberExpected" value="">
                    휴면 전환
                    <select class="form-control " id="expirationDay" name="expirationDay" disabled="true"><option value="7"  >7</option><option value="30"  >30</option><option value="60"  >60</option></select>일 전 회원
                </label>
            </td>
        </tr>
        <tr>
            <th>연결계정</th>
            <td>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="" checked="checked"/>
                    전체
                </label>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="payco" />
                    페이코
                </label>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="facebook" />
                    페이스북
                </label>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="naver" />
                    네이버
                </label>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="kakao" />
                    카카오
                </label>
                <label class="radio-inline">
                    <input type="radio" name="connectSns"
                           value="wonder" />
                    위메프
                </label>
            </td>
            <th>휴면해제일</th>
            <td>
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="sleepWakeDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
                ~
                <div class="input-group js-datepicker">
                    <input type="text" class="form-control" placeholder="" name="sleepWakeDt[]"
                           value=""/>
                    <span class="input-group-addon">
                        <span class="btn-icon-calendar">
                        </span>
                    </span>
                </div>
            </td>
        </tr>
        </tbody>
    </table>
    <button type="button" class="btn btn-sm btn-link js-search-toggle bold">상세검색
        <span>펼침</span>
    </button>
</div>
<div class="table-btn">
    <input type="submit" value="검색" class="btn btn-lg btn-black js-search-button"/>
</div>

<script type="text/javascript">
    var detailSearch = {
        $age: $('#age', '.search-detail-box'),
        $under14: $(':checkbox[name=under14]', '.search-detail-box')
    };
    detailSearch.$under14.click(function () {
        detailSearch.$age.val('');
    });
    detailSearch.$age.change(function () {
        if (detailSearch.$age.val() > 0) {
            detailSearch.$under14.prop('checked', false);
        }
    });
    function checkDormant() {
        if($('input:checkbox[name="dormantMemberExpected"]').val() == 'y') {
            $('#dormantMemberExpected').prop('checked', true);
            $('input[name="novisit"]').attr('disabled', true);
            $("#expirationDay").attr('disabled', false);
        }
    }
    $(document).on('click', 'input[name=dormantMemberExpected]', function(e){
        if($(this).prop("checked")) {
            $(this).val('y');
            $('input[name="novisit"]').attr('disabled',true);
            if($('input[name="novisit"]').val() != '') { //장기 미로그인 값이 존재하면 drop
                $('input[name="novisit"]').val('');
            }
            $("#expirationDay").attr('disabled', false);
            $('input[id="expirationNone"]').attr('disabled',true);
        } else {
            $(this).val('n');
            $('input[name="novisit"]').attr('disabled',false);
            $("#expirationDay").attr('disabled', true);
            $('input[id="expirationNone"]').attr('disabled',false);
        }
    });
    function getMonthFormatDate(date) {
        var today = new Date();
        var month = date.substring(0, 2);
        var day = date.substring(month.length, date.length);
        var maxDate = 31;

        if(month.length == 1) month = '0' + month;
        if(day.length == 1) day = '0' + day;
        if(date.length <= 2) day = '01';

        if(month == 4 || month == 6 || month == 9 || month == 11) {
            maxDate = 30;
        } else if(month == 2) {
            maxDate = 29;
        }

        if(month > 12) {
            today.getMonth() >= 9 ? (month = today.getMonth() + 1) : (month = '0' + (today.getMonth() + 1))
            today.getDate() >= 10 ? day = today.getDate() : day = '0' + today.getDate()
        } else if(day > maxDate) {
            day = maxDate;
        }

        if (month == '00')  month = '01';
        if (day == '00')    day = '01';

        return month + '-' + day;
    }

    function getYearFormatDate(date) {
        var today = new Date();
        var year = date.substring(0, 4);
        var month = date.substr(year.length, 2);
        var day = date.substring((year.length + month.length), date.length);
        var maxDate = 31;

        if(month.length == 1) month = '0' + month;
        if(day.length == 1) day = '0' + day;
        if(date.length <= 6) day = '01';

        if(month == 4 || month == 6 || month == 9 || month == 11) {
            maxDate = 30;
        } else if(month == 2) {
            ((year%4 == 0 && year%100 != 0) || year%400 == 0) ? maxDate = 29 : maxDate = 28
        }

        if(month > 12) {
            year = today.getFullYear();
            today.getMonth() >= 9 ? (month = today.getMonth() + 1) : (month = '0' + (today.getMonth() + 1))
            today.getDate() >= 10 ? day = today.getDate() : day = '0' + today.getDate()
        } else if(day > maxDate) {
            day = maxDate;
        }

        if (year == '0000') year = '0001';
        if (month == '00')  month = '01';
        if (day == '00')    day = '01';

        return year + '-' + month + '-' + day;
    }

    function checkBirthFl() {
        if($('input:checkbox[name="birthFl"]').val() == 'y') {
            $('#birthCheckFl').prop('checked', true);
            $('.seconddate').hide();
            $('.seconddate').val('');
        }
    }

    $(document).ready(function () {

       $('.js-datepicker').datetimepicker().on('dp.change', function(){
           if($(this).prop('class') == 'input-group js-datepicker firstdate') {
               $('#birthDt1').val($('#yBirthDt1').val());
           } else if($(this).prop('class') == 'input-group js-datepicker seconddate') {
               $('#birthDt2').val($('#yBirthDt2').val());
           }
       })

       $('#birthCheckFl').on('click', function(){
            if($(this).is(":checked")) {
                $(this).val('y');
                $('.seconddate').hide();
                $('.seconddate').val('');
            } else {
                $(this).val('n');
                $('.seconddate').show();
            }
        })

       $('input[name=\'birthDt[]\']').on('change', function(){
           if($(this).val().substr(0, 1) == '-') {
               var today = new Date();
               var month = today.getMonth() + 1;
               var day = today.getDate();

               if (month < 10)  month = '0' + month;
               if (day < 10)    day = '0' + day;

               $(this).val(today.getFullYear() + '-' + month + '-' + day);
           } else {
               var date = $(this).val().replace(/-/g, '');
               if(date.length > 0) {
                   date.length <= 4 ? $(this).val(getMonthFormatDate(date)) : $(this).val(getYearFormatDate(date))
               }
           }
       })

       $('input[type=submit]').on('click', function(){
           if(($('#birthDt1').val().length == 5 && $('#birthDt2').val().length == 10)
               || ($('#birthDt1').val().length == 10 && $('#birthDt2').val().length == 5)){
               dialog_alert('생일 검색 기간을 다시 확인해주세요.', '정보');
               return false;
           }
       })

        checkBirthFl();
        checkDormant();
    })
</script>
</form>

<form id="frmList" action="" method="get" target="ifrmProcess">
    <div class="table-header form-inline">
        <div class="pull-left">
            검색 <strong class="text-danger">2</strong>명 / 전체 <strong class="text-danger">2</strong>명        </div>
        <div class="pull-right">
            <div>
                <select class=" js-page-number form-control" id="pageNum" name="pageNum" ><option value="10" selected="selected" >10개 보기</option><option value="20"  >20개 보기</option><option value="30"  >30개 보기</option><option value="40"  >40개 보기</option><option value="50"  >50개 보기</option><option value="60"  >60개 보기</option><option value="70"  >70개 보기</option><option value="80"  >80개 보기</option><option value="90"  >90개 보기</option><option value="100"  >100개 보기</option><option value="200"  >200개 보기</option><option value="300"  >300개 보기</option><option value="500"  >500개 보기</option></select>            </div>
        </div>
    </div>

    <table class="table table-rows">
        <colgroup>
            <col class="width-xs"/>
            <col class="width-xs"/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
            <col/>
        </colgroup>
        <thead>
        <tr>
            <th>
                <input type="checkbox" id="chk_all" class="js-checkall"
                       data-target-name="chk"/>
            </th>
            <th>번호</th>
                            <th>상점 구분</th>
                        <th>아이디/닉네임</th>
            <th>이름</th>
            <th>등급</th>
            <th>주문금액</th>
            <th>마일리지</th>
            <th>예치금</th>
            <th>회원가입일</th>
            <th>최종로그인</th>
            <th>가입승인</th>
        </tr>
        </thead>
        <tbody>
                        <tr class="center" data-member-no="2">
                    <td>
                        <input type="checkbox" name="chk[]" value="2"
                               data-appFl="y"
                               data-maillingFl="y"
                               data-smsFl="y"/>
                    </td>
                    <td class="number js-layer-crm hand">2</td>
                                            <td class="">
                            <span class="flag flag-16 flag-kr"></span>기준몰                        </td>
                                        <td class="js-layer-crm hand">
                        <span class="font-eng">
                            test_id_2                        </span>
                                                                            <div class="notice-ref notice-sm">이회원</div>                    </td>
                    <td class="js-layer-crm hand">
                        이회원                    </td>
                    <td class="js-layer-crm hand">일반회원</td>
                    <td class="number js-layer-crm hand">268,000</td>
                    <td class="number js-layer-crm hand">2,150</td>
                    <td class="number js-layer-crm hand">2,000</td>
                    <td class="date js-layer-crm hand">10-09-01</td>
                    <td class="date js-layer-crm hand">16-05-10</td>
                    <td class="js-layer-crm hand">승인</td>
                </tr>
                                <tr class="center" data-member-no="7">
                    <td>
                        <input type="checkbox" name="chk[]" value="7"
                               data-appFl="y"
                               data-maillingFl="y"
                               data-smsFl="y"/>
                    </td>
                    <td class="number js-layer-crm hand">1</td>
                                            <td class="">
                            <span class="flag flag-16 flag-kr"></span>기준몰                        </td>
                                        <td class="js-layer-crm hand">
                        <span class="font-eng">
                            test_id_7                        </span>
                                                                            <div class="notice-ref notice-sm">황회원</div>                    </td>
                    <td class="js-layer-crm hand">
                        황회원                    </td>
                    <td class="js-layer-crm hand">우수회원</td>
                    <td class="number js-layer-crm hand">12,000</td>
                    <td class="number js-layer-crm hand">2,000</td>
                    <td class="number js-layer-crm hand">2,000</td>
                    <td class="date js-layer-crm hand">10-09-01</td>
                    <td class="date js-layer-crm hand">16-05-10</td>
                    <td class="js-layer-crm hand">승인</td>
                </tr>
                        </tbody>
    </table>

    <div class="center"><nav><ul class="pagination pagination-sm"><li class="active"><span>1</span></li></ul></nav></div>
</form>

<form name="setupForm" id="setupForm" method="post" class="content-form js-setup-form">
    <input type="hidden" name="batchTarget[]" value=""/>
    <input type="hidden" name="memberType" value=""/>
    <input type="hidden" name="searchJson" value="{&quot;page&quot;:1,&quot;pageNum&quot;:10,&quot;mode&quot;:&quot;batch_app&quot;,&quot;approvalStatus&quot;:&quot;y&quot;,&quot;memberType&quot;:&quot;select&quot;}"/>

    <div class="form-inline">
        <table class="table table-cols">
            <colgroup>
                <col class="width-md"/>
                <col/>
            </colgroup>
            <tbody>
            <tr>
                <th>처리항목</th>
                <td colspan="3">
                    <label class="radio-inline">
                        <input type="radio" name="mode"
                               value="batch_app" checked="checked"                               data-target=".tr-apply"/>
                        가입승인
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="mode"
                               value="batch_group"                                data-target=".tr-group"/>
                        등급변경
                    </label>
                </td>
            </tr>
            <tr class="tr-apply">
                <th>변경상태선택</th>
                <td>
                    <label class="radio-inline">
                        <input type="radio" name="approvalStatus"
                               value="y" checked="checked" />
                        승인
                    </label>
                    <label class="radio-inline">
                        <input type="radio" name="approvalStatus"
                               value="n" />
                        미승인
                    </label>
                </td>
            </tr>
            <tr class="tr-group">
                <th>변경등급선택</th>
                <td>
                    <select class="form-control " id="newGroupSno" name="newGroupSno" ><option value="">등급선택</option><option value="1"  >일반회원</option><option value="2"  >우수회원</option></select>                    <a href="../member/member_group_list.php" target="_blank">
                        <span
                                class="notice-ref notice-sm">회원등급 설정 내용 확인 및 추가&gt;
                        </span>
                    </a>
                </td>
            </tr>
            </tbody>
        </table>
        <p class="notice-danger">자동발송 설정에 따라 회원상태 변경 시 회원에게 SMS/메일로 안내메시지가 발송되므로 주의하시기 바랍니다.</p>
    </div>
</form>
<script type="text/javascript">
    var $formList = $('#frmList');
    var $formSearch = $('.js-search-form');
    var $formSetup = $('.js-setup-form');
    var search_total = '2';
    var data;

    $(document).ready(function () {
        $('.search-detail-box tbody:eq(0)').prepend(_.template($('#templateAddDetailSearch').html()));

        member.toggleEventApplyQuery();

        $(':radio[name=mode]').on('change', function (e) {
            member.target_display_switch(e);
        }).filter(':checked').trigger('change');

        $('select[name=\'pageNum\']').change({targetForm: '.js-search-form'}, member.page_number);

        $formSetup.validate({
            ignore: [],
            dialog: false,
            rules: {
                groupSno: {
                    required: function () {
                        return $(':radio[name=mode]:checked', $formSetup).val() == 'batch_group';
                    }
                },
                "batchTarget[]": {
                    required: function () {
                        return $(':radio[name=memberType]:checked', $formSearch).val() == 'select' && $(':checkbox:checked', $formList).length == 0;
                    }
                }
            }, messages: {
                groupSno: "변경하실 등급을 선택해 주세요.",
                "batchTarget[]": {
                    required: function () {
                        if ($(':radio[name=mode]:checked', $formSetup).val() == 'batch_group') {
                            return '등급을 변경할 대상 회원을 선택해주세요.';
                        } else {
                            return '가입승인상태를 변경할  대상 회원을 선택해주세요.';
                        }
                    }
                }
            }, submitHandler: function (form) {
                var $form = $(form);
                data = $form.serializeArray();

                var mode = $(':radio[name=mode]:checked', $formSetup).val();
                var approval_fl = $(':radio[name=approvalStatus]:checked', $form).val();
                var member_type = $(':radio[name=memberType]:checked', $formSearch).val();

                try {
                    if (member_type === 'select') {
                        $("input[name='chk[]']:checked", $formList).each(function () {
                            data.push({name: "chk[]", value: $(this).val()});
                        });
                    }

                    var is_batch_app_mode = (mode === 'batch_app');
                    var is_batch_group_mode = (mode === 'batch_group');
                    var is_member_type_query = (member_type === 'query');
                    var is_member_type_select = (member_type === 'select');
                    var is_approval_flag = (approval_fl === 'y');
                    var is_disapproval_flag = (approval_fl === 'n');
                    if (is_batch_app_mode && is_member_type_query && is_approval_flag) {
                        data.push({name: "mode", value: "all_approval_join"});
                    } else if (is_batch_app_mode && is_member_type_query && is_disapproval_flag) {
                        data.push({name: "mode", value: "all_disapproval_join"});
                    } else if (is_batch_app_mode && is_member_type_select && is_approval_flag) {
                        data.push({name: "mode", value: "approval_join"});
                    } else if (is_batch_app_mode && is_member_type_select && is_disapproval_flag) {
                        data.push({name: "mode", value: "disapproval_join"});
                    } else if (is_batch_group_mode && is_member_type_query) {
                        if ($('#newGroupSno').val() < 1) {
                            alert('회원등급을 선택해 주시기 바랍니다.');
                            return false;
                        }
                        data.push({name: "mode", value: "all_apply_group_grade"});
                    } else if (is_batch_group_mode && is_member_type_select) {
                        if ($('#newGroupSno').val() < 1) {
                            alert('회원등급을 선택해 주시기 바랍니다.');
                            return false;
                        }
                        data.push({name: "mode", value: "apply_group_grade"});
                    } else {
                        alert("가입승인/등급변경 조건이 올바르지 않습니다.");
                    }

                } catch (error) {
                    alert("가입승인/등급변경 처리 중 오류가 발생하였습니다.");
                }

                if (is_approval_flag) {
                    var new_group_name = $('#newGroupSno option:selected').text();
                    var message = '검색된 ' + search_total + '명의 가입을 승인하시겠습니까?<br/>(자동발송 설정에 따라 회원에게 SMS/메일이 발송됩니다.)';
                    if (is_member_type_select && is_batch_app_mode) {
                        message = '선택한 ' + $(':checkbox:checked', $formList).not('.js-checkall').length + '명의 가입을 승인하시겠습니까?<br/>(자동발송 설정에 따라 회원에게 SMS/메일이 발송됩니다.)';
                    } else if (is_member_type_query && is_batch_group_mode) {
                        message = '검색된 ' + search_total + '명의 회원등급을 ' + new_group_name + '으로 변경하시겠습니까?<br/>(자동발송 설정에 따라 회원에게 SMS/메일이 발송됩니다.)';
                    } else if (is_member_type_select && is_batch_group_mode) {
                        message = '선택한 ' + $(':checkbox:checked', $formList).not('.js-checkall').length + '명의 회원등급이 ' + new_group_name + '으로 변경됩니다.<br/>(자동발송 설정에 따라 회원에게 SMS/메일이 발송됩니다.)';
                    }

                    dialog_confirm(message, function (result) {
                        if (result) {
                            if((is_member_type_query && search_total >= 100) || (is_member_type_select && $(':checkbox:checked', $formList).not('.js-checkall').length >= 100)) {
                                var ckeckData = {
                                    'mode': 'checkSendSms'
                                }
                                if(is_batch_app_mode) {
                                    ckeckData.checkType = 'join';
                                } else {
                                    ckeckData.checkType = 'group';
                                    ckeckData.groupSno = $('#newGroupSno').val();
                                }
                                var $ajax = $.ajax('../member/member_ps.php', {type: "post", data: ckeckData});
                                $ajax.done(function (ret, textStatus, jqXHR) {
                                    if(ret === true) {
                                        $.get('../share/layer_sms_password.php?mode=input', function () {
                                            BootstrapDialog.show({
                                                title: 'SMS 인증번호 입력',
                                                size: BootstrapDialog.SIZE_WIDE,
                                                message: arguments[0]
                                            });
                                        });
                                    } else {
                                        data.push({name: "passwordCheckFl", value: "n"});
                                        post_with_reload('../member/member_batch_ps.php', data, window.location.pathname);
                                    }
                                });
                            } else {
                                data.push({name: "passwordCheckFl", value: "n"});
                                post_with_reload('../member/member_batch_ps.php', data, window.location.pathname);
                            }
                        }
                    });
                } else {
                    data.push({name: "passwordCheckFl", value: "n"});
                    post_with_reload('../member/member_batch_ps.php', data, window.location.pathname);
                }


            }
        });

        $formSearch.validate({
            submitHandler: function (form) {
                var queryString1 = $(form).serialize();
                var queryString2 = $formSetup.find(':checked, :text, select').serialize();
                window.location.href = '../member/member_batch_approval_with_group.php?' + queryString1 + '&' + queryString2;
            }
        });

        $('.btn-register').click(function () {
            $('#setupForm').submit();
        });
    });
    function sms_password_callback(password) {
        data.push({name: "password", value: password});
        post_with_reload('../member/member_batch_ps.php', data, window.location.pathname);
    }
</script>
<script type="text/html" id="templateAddDetailSearch">
    <tr>
        <th>대상회원 선택</th>
        <td colspan="3">
            <label class="radio-inline">
                <input type="radio" name="memberType" class="js-apply-query"
                       value="query" />
                검색회원 전체적용
            </label>
            <label class="radio-inline">
                <input type="radio" name="memberType" class="js-apply-query"
                       value="select" checked="checked"/>
                회원선택 적용
            </label>
        </td>
    </tr>
</script>

                                    </div>
            </div>





</th:block>


</html>
